// Define allowed coordinates and radius (in kilometers)
const allowedCoordinates = [
    { lat: -1.396732, lon: 36.748442 },
    { lat: -1.398310, lon: 36.751777 },
    { lat: -1.397311, lon: 36.757197 },
    { lat: -1.396529, lon: 36.740211 },
    { lat: -1.397676, lon: 36.764096 },
    { lat: -1.390652, lon: 36.767931 }
];
const allowedRadius = 0.025; // 25 meters in kilometers

document.getElementById('responseForm').addEventListener('submit', function (event) {
    event.preventDefault();
    
    // Get user location
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            const userLocation = {
                lat: position.coords.latitude,
                lon: position.coords.longitude
            };

            // Check if user location is within the allowed area
            const isAllowed = allowedCoordinates.some(center => {
                return isWithinRadius(userLocation, center, allowedRadius);
            });

            // Handle form submission
            if (isAllowed) {
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;

                // Here, you would normally send the data to your server or Google Form
                console.log(`Form submitted successfully: Name: ${name}, Email: ${email}`);
                document.getElementById('message').innerText = 'Form submitted successfully!';
            } else {
                document.getElementById('message').innerText = 'You are not in an allowed location to submit the form.';
            }
        }, () => {
            document.getElementById('message').innerText = 'Unable to retrieve your location.';
        });
    } else {
        document.getElementById('message').innerText = 'Geolocation is not supported by your browser.';
    }
});

// Function to check if the user's location is within a given radius
function isWithinRadius(userLocation, center, radius) {
    const R = 6371; // Radius of the Earth in kilometers
    const dLat = toRadians(userLocation.lat - center.lat);
    const dLon = toRadians(userLocation.lon - center.lon);

    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(toRadians(center.lat)) * Math.cos(toRadians(userLocation.lat)) *
              Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distance = R * c; // Distance in kilometers

    return distance <= radius; // Return true if within the allowed radius
}

// Helper function to convert degrees to radians
function toRadians(degrees) {
    return degrees * Math.PI / 180;
}
